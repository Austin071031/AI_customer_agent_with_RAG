{
  "id": "snapshot_1761809247302_rdyugs76g",
  "approvalId": "approval_1761809247291_ly3ngq7l8",
  "approvalTitle": "AI Customer Agent Design Specification",
  "version": 1,
  "timestamp": "2025-10-30T07:27:27.302Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# AI Customer Agent - Design Specification\r\n\r\n## System Architecture\r\n\r\n### High-Level Architecture\r\n```\r\n┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐\r\n│   Web/Desktop   │◄──►│   FastAPI Backend │◄──►│  DeepSeek API   │\r\n│    Interface    │    │                  │    │                 │\r\n└─────────────────┘    └──────────────────┘    └─────────────────┘\r\n                                │\r\n                                ▼\r\n                       ┌──────────────────┐\r\n                       │ Local Knowledge  │\r\n                       │     Base         │\r\n                       │   (Vector DB)    │\r\n                       └──────────────────┘\r\n```\r\n\r\n### Component Architecture\r\n```\r\n┌─────────────────────────────────────────────────────────────┐\r\n│                    Presentation Layer                        │\r\n├─────────────────────────────────────────────────────────────┤\r\n│  • Streamlit Web Interface                                  │\r\n│  • Desktop GUI (Tkinter/PyQt)                              │\r\n│  • REST API Endpoints                                       │\r\n└─────────────────────────────────────────────────────────────┘\r\n                              │\r\n┌─────────────────────────────────────────────────────────────┐\r\n│                    Application Layer                         │\r\n├─────────────────────────────────────────────────────────────┤\r\n│  • Chat Manager                                            │\r\n│  • Knowledge Base Manager                                  │\r\n│  • Session Manager                                         │\r\n│  • Configuration Manager                                   │\r\n└─────────────────────────────────────────────────────────────┘\r\n                              │\r\n┌─────────────────────────────────────────────────────────────┐\r\n│                     Service Layer                            │\r\n├─────────────────────────────────────────────────────────────┤\r\n│  • DeepSeek API Service                                    │\r\n│  • Embedding Service                                       │\r\n│  • Vector Search Service                                   │\r\n│  • File Processing Service                                 │\r\n└─────────────────────────────────────────────────────────────┘\r\n                              │\r\n┌─────────────────────────────────────────────────────────────┐\r\n│                     Data Layer                               │\r\n├─────────────────────────────────────────────────────────────┤\r\n│  • Chroma Vector Database                                  │\r\n│  • Local File System                                       │\r\n│  • Configuration Files                                     │\r\n└─────────────────────────────────────────────────────────────┘\r\n```\r\n\r\n## Technology Stack\r\n\r\n### Core Technologies\r\n- **Programming Language**: Python 3.8+\r\n- **Web Framework**: FastAPI (for API) + Streamlit (for UI)\r\n- **Vector Database**: ChromaDB (local, lightweight)\r\n- **Embedding Model**: sentence-transformers (all-MiniLM-L6-v2)\r\n- **GPU Acceleration**: CUDA + PyTorch with GPU support\r\n\r\n### Key Dependencies\r\n```python\r\n# Core AI/ML\r\ntorch>=2.0.0\r\ntransformers>=4.30.0\r\nsentence-transformers>=2.2.0\r\nlangchain>=0.0.200\r\nchromadb>=0.4.0\r\n\r\n# API & Web\r\nfastapi>=0.100.0\r\nuvicorn>=0.20.0\r\nstreamlit>=1.25.0\r\nrequests>=2.28.0\r\n\r\n# File Processing\r\npypdf2>=3.0.0\r\npython-docx>=0.8.11\r\nopenpyxl>=3.1.0\r\n\r\n# Utilities\r\npython-dotenv>=1.0.0\r\nloguru>=0.7.0\r\npydantic>=2.0.0\r\n```\r\n\r\n## Core Components Design\r\n\r\n### 1. DeepSeek API Service\r\n```python\r\nclass DeepSeekService:\r\n    def __init__(self, api_key: str, base_url: str = \"https://api.deepseek.com\"):\r\n        self.api_key = api_key\r\n        self.base_url = base_url\r\n        \r\n    async def chat_completion(self, messages: List[Dict], model: str = \"deepseek-chat\") -> str:\r\n        \"\"\"Send chat completion request to DeepSeek API\"\"\"\r\n        \r\n    async def stream_chat(self, messages: List[Dict], model: str = \"deepseek-chat\") -> AsyncGenerator:\r\n        \"\"\"Stream chat responses from DeepSeek API\"\"\"\r\n```\r\n\r\n### 2. Knowledge Base Manager\r\n```python\r\nclass KnowledgeBaseManager:\r\n    def __init__(self, persist_directory: str = \"./knowledge_base\"):\r\n        self.vector_store = Chroma(\r\n            persist_directory=persist_directory,\r\n            embedding_function=SentenceTransformerEmbeddings()\r\n        )\r\n        \r\n    def add_documents(self, file_paths: List[str]) -> bool:\r\n        \"\"\"Process and add documents to knowledge base\"\"\"\r\n        \r\n    def search_similar(self, query: str, k: int = 3) -> List[Document]:\r\n        \"\"\"Search for similar documents in knowledge base\"\"\"\r\n        \r\n    def clear_knowledge_base(self) -> bool:\r\n        \"\"\"Clear all documents from knowledge base\"\"\"\r\n```\r\n\r\n### 3. Chat Manager\r\n```python\r\nclass ChatManager:\r\n    def __init__(self, deepseek_service: DeepSeekService, kb_manager: KnowledgeBaseManager):\r\n        self.deepseek_service = deepseek_service\r\n        self.kb_manager = kb_manager\r\n        self.conversation_history = []\r\n        \r\n    async def process_message(self, user_message: str, use_knowledge_base: bool = True) -> str:\r\n        \"\"\"Process user message with optional knowledge base context\"\"\"\r\n        \r\n    def get_conversation_history(self) -> List[Dict]:\r\n        \"\"\"Get current conversation history\"\"\"\r\n        \r\n    def clear_conversation(self) -> None:\r\n        \"\"\"Clear conversation history\"\"\"\r\n```\r\n\r\n### 4. Configuration Manager\r\n```python\r\nclass ConfigManager:\r\n    def __init__(self, config_path: str = \"./config\"):\r\n        self.config_path = config_path\r\n        self.settings = self._load_settings()\r\n        \r\n    def _load_settings(self) -> Dict:\r\n        \"\"\"Load configuration from YAML/JSON files\"\"\"\r\n        \r\n    def update_setting(self, key: str, value: Any) -> bool:\r\n        \"\"\"Update configuration setting\"\"\"\r\n        \r\n    def get_deepseek_api_key(self) -> str:\r\n        \"\"\"Get DeepSeek API key from configuration\"\"\"\r\n```\r\n\r\n## Data Models\r\n\r\n### Chat Message\r\n```python\r\nclass ChatMessage(BaseModel):\r\n    role: Literal[\"user\", \"assistant\", \"system\"]\r\n    content: str\r\n    timestamp: datetime = Field(default_factory=datetime.now)\r\n    message_id: str = Field(default_factory=lambda: str(uuid.uuid4()))\r\n```\r\n\r\n### Knowledge Base Document\r\n```python\r\nclass KBDocument(BaseModel):\r\n    id: str\r\n    content: str\r\n    metadata: Dict[str, Any]\r\n    file_path: str\r\n    file_type: str\r\n    embedding: Optional[List[float]] = None\r\n```\r\n\r\n### API Configuration\r\n```python\r\nclass APIConfig(BaseModel):\r\n    api_key: str\r\n    base_url: str = \"https://api.deepseek.com\"\r\n    model: str = \"deepseek-chat\"\r\n    temperature: float = 0.7\r\n    max_tokens: int = 2000\r\n```\r\n\r\n## API Endpoints Design\r\n\r\n### FastAPI Endpoints\r\n```python\r\n# Chat endpoints\r\n@app.post(\"/api/chat\")\r\nasync def chat_endpoint(message: str, use_kb: bool = True) -> Dict:\r\n    \"\"\"Process chat message with optional knowledge base\"\"\"\r\n\r\n@app.get(\"/api/chat/history\")\r\nasync def get_chat_history() -> List[ChatMessage]:\r\n    \"\"\"Get conversation history\"\"\"\r\n\r\n@app.delete(\"/api/chat/history\")\r\nasync def clear_chat_history() -> Dict:\r\n    \"\"\"Clear conversation history\"\"\"\r\n\r\n# Knowledge base endpoints\r\n@app.post(\"/api/knowledge-base/documents\")\r\nasync def add_documents(files: List[UploadFile]) -> Dict:\r\n    \"\"\"Add documents to knowledge base\"\"\"\r\n\r\n@app.get(\"/api/knowledge-base/search\")\r\nasync def search_knowledge_base(query: str, k: int = 3) -> List[KBDocument]:\r\n    \"\"\"Search knowledge base\"\"\"\r\n\r\n@app.delete(\"/api/knowledge-base\")\r\nasync def clear_knowledge_base() -> Dict:\r\n    \"\"\"Clear knowledge base\"\"\"\r\n\r\n# Configuration endpoints\r\n@app.get(\"/api/config\")\r\nasync def get_configuration() -> Dict:\r\n    \"\"\"Get current configuration\"\"\"\r\n\r\n@app.put(\"/api/config\")\r\nasync def update_configuration(config: Dict) -> Dict:\r\n    \"\"\"Update configuration\"\"\"\r\n```\r\n\r\n## User Interface Design\r\n\r\n### Streamlit Web Interface\r\n```python\r\n# Main components\r\n- Sidebar: Configuration and knowledge base management\r\n- Main area: Chat interface with message history\r\n- Header: Application status and GPU utilization\r\n\r\n# Features\r\n- Real-time chat with streaming responses\r\n- File upload for knowledge base\r\n- Configuration settings panel\r\n- Conversation history management\r\n- GPU status monitoring\r\n```\r\n\r\n### Desktop GUI (Alternative)\r\n- **Framework**: Tkinter or PyQt\r\n- **Features**: Native Windows application with system tray integration\r\n- **Advantages**: Better performance, system integration\r\n\r\n## GPU Optimization\r\n\r\n### CUDA Configuration\r\n```python\r\ndef setup_gpu():\r\n    \"\"\"Configure PyTorch for NVIDIA 4070Ti GPU\"\"\"\r\n    if torch.cuda.is_available():\r\n        device = torch.device(\"cuda\")\r\n        torch.backends.cudnn.benchmark = True\r\n        return device\r\n    return torch.device(\"cpu\")\r\n```\r\n\r\n### Batch Processing\r\n- Use batch processing for document embeddings\r\n- Implement async operations for API calls\r\n- Optimize vector search with GPU acceleration\r\n\r\n## Security Considerations\r\n\r\n### Data Protection\r\n- All data stored locally\r\n- API keys encrypted in configuration\r\n- No external data transmission beyond DeepSeek API\r\n\r\n### Input Validation\r\n- Sanitize file uploads\r\n- Validate API inputs\r\n- Rate limiting for API calls\r\n\r\n## Performance Optimization\r\n\r\n### Caching Strategy\r\n```python\r\nclass ResponseCache:\r\n    def __init__(self, max_size: int = 1000):\r\n        self.cache = LRUCache(max_size=max_size)\r\n        \r\n    def get_cached_response(self, query: str) -> Optional[str]:\r\n        \"\"\"Get cached response for query\"\"\"\r\n        \r\n    def cache_response(self, query: str, response: str) -> None:\r\n        \"\"\"Cache response for future use\"\"\"\r\n```\r\n\r\n### Async Operations\r\n- Use async/await for all I/O operations\r\n- Implement connection pooling for API calls\r\n- Background tasks for knowledge base indexing\r\n\r\n## Deployment Architecture\r\n\r\n### Local Deployment\r\n```\r\n┌─────────────────────────────────────────────────────────────┐\r\n│                    Windows Local Machine                    │\r\n├─────────────────────────────────────────────────────────────┤\r\n│  • Python Virtual Environment                              │\r\n│  • FastAPI Server (localhost:8000)                         │\r\n│  • Streamlit UI (localhost:8501)                           │\r\n│  • ChromaDB Vector Store (local files)                     │\r\n│  • GPU Acceleration (NVIDIA 4070Ti)                        │\r\n└─────────────────────────────────────────────────────────────┘\r\n```\r\n\r\n### File Structure\r\n```\r\nai-customer-agent/\r\n├── src/\r\n│   ├── services/\r\n│   │   ├── deepseek_service.py\r\n│   │   ├── knowledge_base.py\r\n│   │   └── chat_manager.py\r\n│   ├── api/\r\n│   │   ├── main.py\r\n│   │   └── endpoints/\r\n│   ├── ui/\r\n│   │   └── streamlit_app.py\r\n│   └── models/\r\n│       ├── chat_models.py\r\n│       └── config_models.py\r\n├── config/\r\n│   ├── settings.yaml\r\n│   └── .env\r\n├── knowledge_base/\r\n│   └── chroma_db/\r\n├── logs/\r\n└── requirements.txt\r\n```\r\n\r\n## Error Handling & Logging\r\n\r\n### Error Handling Strategy\r\n- Comprehensive exception handling for all components\r\n- Graceful degradation when services are unavailable\r\n- User-friendly error messages\r\n\r\n### Logging Configuration\r\n```python\r\nimport loguru\r\n\r\nlogger.add(\r\n    \"logs/app.log\",\r\n    rotation=\"10 MB\",\r\n    retention=\"30 days\",\r\n    level=\"INFO\"\r\n)\r\n```\r\n\r\n## Testing Strategy\r\n\r\n### Test Types\r\n- Unit tests for individual components\r\n- Integration tests for API endpoints\r\n- End-to-end tests for user workflows\r\n- Performance tests for GPU utilization\r\n\r\n### Test Framework\r\n- pytest for Python tests\r\n- pytest-asyncio for async tests\r\n- unittest for component tests\r\n\r\n## Monitoring & Maintenance\r\n\r\n### Health Checks\r\n- API endpoint health monitoring\r\n- GPU utilization tracking\r\n- Knowledge base integrity checks\r\n\r\n### Maintenance Tasks\r\n- Regular knowledge base optimization\r\n- Log file rotation and cleanup\r\n- Configuration backup\r\n",
  "fileStats": {
    "size": 14469,
    "lines": 389,
    "lastModified": "2025-10-30T07:27:02.319Z"
  },
  "comments": []
}